'use strict'

const computeOut = require('./compute-out')
const { posix: path } = require('node:path')

function createAsciiDocFile (contentCatalog, file) {
  file.mediaType = 'text/asciidoc'
  const src = file.src
  const out = computeOut.call(contentCatalog, src)
  if (src.family === 'export') {
    contentCatalog.removeFile((file = contentCatalog.addFile(Object.assign(file, { path: out.path, out: null }))))
    return file
  }
  const pub = { url: '/' + out.path, moduleRootPath: out.moduleRootPath, rootPath: out.rootPath }
  return { contents: src.contents ?? Buffer.alloc(0), src, out, pub }
}

module.exports = createAsciiDocFile
